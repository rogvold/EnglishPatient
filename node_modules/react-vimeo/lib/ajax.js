'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
});
exports.get = get;

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _debug = require('debug');

var _debug2 = _interopRequireDefault(_debug);

var errMessage = { error: 'Sorry, an error occurred on the server' };
var debug = (0, _debug2['default'])('vimeo:ajax');

function get(opts) {
  var url = opts.url;
  var onSuccess = opts.onSuccess;
  var onError = opts.onError;
  var req = undefined;

  try {
    req = new XMLHttpRequest();
  } catch (e) {
    req = new XDomainRequest();
  }

  // XDomainRequest onload
  // ie 8-9 support
  function oldIE() {
    onSuccess(JSON.parse(req.responseText));
  }

  // XMLHttpRequest onload
  function onReadyStateChange() {
    if (req.readyState !== 4 || req.status !== 200) {
      return;
    }
    return onSuccess(JSON.parse(req.responseText));
  }

  function errHandler(err) {
    debug('error occured fetching video data', err);
    return onError(errMessage);
  }

  req.onreadystatechange = onReadyStateChange;
  req.onload = oldIE;
  req.onerror = errHandler;
  req.open('GET', url, true);
  req.send();

  return req.abort.bind(req);
}